import{O as _,aZ as m,aT as f,j as p,k as q,l as a,a3 as b,d as s,P as i,a6 as k,Q as V,G as r,a4 as C,U as B,a$ as g,a5 as c,a0 as S,Z as T,b2 as D,a_ as I,R as U,a8 as N}from"./index.15549c5f.js";import{Q as h}from"./QTd.d2ef90c8.js";import{Q as R}from"./QTable.fed3df48.js";import{Q as j}from"./QCheckbox.319b037f.js";import"./QSeparator.99c532f3.js";import"./QMenu.14b581ee.js";import"./QChip.b33c0246.js";import"./QItemLabel.7b44cda4.js";import"./format.2a3572e1.js";const z={id:"feedbackview"},A={class:"text-center"},F={class:"div q-px-xl row"},P={class:"col-12"},Z={class:"div q-pa-md row",align:"left"},$={class:"text-center"},E={class:"col-12 q-pa-md"},G=a("div",{class:"text-h5"},"\u4E3B\u65E8",-1),O={class:"text-h6"},H={class:"col-12 q-pa-md"},J=a("div",{class:"text-h5"},"\u5167\u6587",-1),K={class:"text-h6"},L={class:"col-12"},M={class:"col-2"},W=a("div",{class:"text-h6"},"\u8ACB\u52FE\u9078\u78BA\u5B9A\u56DE\u61C9",-1),re={__name:"FeedbacksView",setup(X){const o=_([]),v={required(e){return!!e||"\u6B04\u4F4D\u5FC5\u586B"}},y=[{name:"username",required:!0,label:"\u4F7F\u7528\u8005\u540D\u7A31",align:"left",field:e=>e.u_id.username,sortable:!0},{name:"title",required:!0,label:"\u56DE\u61C9\u4E3B\u65E8",align:"left",field:e=>e.title,sortable:!0},{name:"description",required:!0,label:"\u4F86\u4FE1\u5167\u5BB9",align:"left",field:e=>e.description,sortable:!0},{name:" reply",required:!0,label:"\u7BA1\u7406\u54E1\u56DE\u61C9",align:"left",field:e=>e.reply,sortable:!0},{name:"status",required:!0,label:"\u72C0\u614B",align:"left",field:e=>e.status,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F",align:"left"}],t=_({_id:"",u_id:"",title:"",description:"",status:"",dialog:!1,reply:"",idx:-1}),w=()=>{t.reply=null},x=e=>{console.log(e),e!==-1&&(t.u_id=o[e].u_id,t._id=o[e]._id,t.description=o[e].description,t.title=o[e].title,o[e].status===1?t.status=!0:t.status=!1,t.reply=o[e].reply,t.idx=e,t.loading=!1),t.dialog=!0,console.log(t)},Q=async()=>{var e,d;try{const{data:l}=await m.patch("/feedbacks/"+t._id,t),u=o.findIndex(n=>n._id===t._id);o[u]=l.result,t.dialog=!1}catch(l){console.log(l),f.fire({icon:"error",title:"\u5931\u6557",text:((d=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:d.message)||"\u767C\u751F\u932F\u8AA4"})}};return(async()=>{try{const{data:e}=await m.get("/feedbacks/all");o.push(...e.result),console.log(o)}catch(e){console.log(e),f.fire({icon:"error",title:"\u5931\u6557",text:"\u53D6\u5F97\u6240\u6709\u56DE\u61C9\u5931\u6557"})}})(),(e,d)=>(p(),q("div",z,[a("h3",A,[b("\u56DE\u61C9\u7BA1\u7406"),a("div",F,[a("div",P,[s(R,{columns:y,rows:o},{"body-cell-status":i(l=>[s(h,null,{default:i(()=>[s(V,{size:"md",name:l.row.status==0?"fa-regular fa-envelope":"fa-solid fa-envelope-circle-check"},null,8,["name"])]),_:2},1024)]),"body-cell-edit":i(l=>[s(h,{class:"q-pa-md q-gutter-sm"},{default:i(()=>[s(r,{size:"md",round:"",color:"primary","text-color":"white",icon:"edit",onClick:u=>x(o.findIndex(n=>n._id===l.row._id))},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows"])])]),s(k,{align:"center",modelValue:t.dialog,"onUpdate:modelValue":d[2]||(d[2]=l=>t.dialog=l),persistent:""},{default:i(()=>[s(C,{class:"column",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[s(B,{onSubmit:Q,onReset:w},{default:i(()=>[s(g,{class:"row flex justify-between"},{default:i(()=>[a("div",Z,[a("div",$,c(t._id.length>0?"\u7BA1\u7406\u8005\u56DE\u61C9":"\u65B0\u589E\u5546\u54C1"),1)]),S((p(),T(r,{dense:"",flat:"",icon:"close"},{default:i(()=>[s(D,null,{default:i(()=>[b("Close")]),_:1})]),_:1})),[[N]])]),_:1}),s(I,{class:"column q-gutter-md",align:"left"},{default:i(()=>[a("div",E,[G,a("div",O,c(t.title),1)]),a("div",H,[J,a("div",K,c(t.description),1)]),a("div",L,[s(U,{square:"",filled:"",modelValue:t.reply,"onUpdate:modelValue":d[0]||(d[0]=l=>t.reply=l),label:"\u7BA1\u7406\u8005\u56DE\u61C9",rules:[v.required]},null,8,["modelValue","rules"])]),a("div",M,[W,s(j,{modelValue:t.status,"onUpdate:modelValue":d[1]||(d[1]=l=>t.status=l)},null,8,["modelValue"])])]),_:1}),s(g,{align:"right"},{default:i(()=>[s(r,{disabled:t.loading,flat:"",label:"reset",type:"reset",color:"red"},null,8,["disabled"]),s(r,{disabled:!t.status,flat:"",label:"submit",type:"submit",color:"green"},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}};export{re as default};
