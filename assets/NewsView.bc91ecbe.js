import{M as f,aM as m,aH as r,j as g,k as v,l as d,d as i,C as c,N as o,Q as _,a0 as q,aP as w,a1 as y,X as C,V as k,$ as S,aO as B,a2 as D}from"./index.467e0a25.js";import{Q as p,a as N,C as U}from"./QForm.54f56720.js";import{Q as F}from"./QTable.155f9cd7.js";import{Q as I}from"./QTooltip.47cf4c74.js";import{Q as T}from"./QFile.92ebf823.js";import{Q as j}from"./use-key-composition.3465fa51.js";import"./QSeparator.4b948942.js";import"./QMenu.fd030325.js";import"./position-engine.6a9cec7f.js";import"./use-prevent-scroll.be416be6.js";import"./QChip.d5b7e8a4.js";import"./QItemLabel.284c4d5f.js";import"./format.2a3572e1.js";import"./QCheckbox.70bf8d02.js";const A={class:"text-center",id:"admin-news"},M=d("h3",null,"\u6700\u65B0\u6D88\u606F\u7BA1\u7406",-1),P={class:"q-px-xl row"},R={class:"col-12"},$={class:"q-px-xl q-mt-md"},E={class:"div q-pa-md row",align:"left"},H={class:"text-center"},O={class:"col-12"},X={class:"col-12"},z={class:"col-5"},G={class:"row"},re={__name:"NewsView",setup(J){const u={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"}},h=()=>{e.image=[]},n=f([]),e=f({_id:"",title:"",image:void 0,description:""}),b=t=>{t===-1?(e._id="",e.title="",e.image=void 0,e.description=""):(e._id=n[t]._id,e.title=n[t].title,e.description=n[t].description,e.image=void 0),e.dialog=!0},V=[{name:"title",required:!0,label:"\u540D\u7A31",align:"left",field:t=>t.title},{name:"description",required:!0,label:"\u7C21\u4ECB",align:"left",field:t=>t.description},{name:"image",required:!0,label:"\u5716\u7247",align:"left",field:t=>t.image}],Q=()=>{e.title="",e.image=void 0,e.description=""},x=async()=>{var l,s;e.loading=!0;const t=new FormData;t.append("title",e.title),t.append("description",e.description),t.append("image",e.image);try{if(e._id.length===0){const{data:a}=await m.post("/news",t);n.push(a.result),r.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:a}=await m.patch("/news/"+e._id,t);n[0]=a.result,r.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(a){r.fire({icon:"error",title:"\u5931\u6557",text:((s=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var t,l;try{const{data:s}=await m.get("/news");n.push(...s.result),console.log(e)}catch(s){r.fire({icon:"error",title:"\u5931\u6557",text:((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,l)=>(g(),v("div",A,[M,d("div",P,[d("div",R,[i(c,{onClick:l[0]||(l[0]=s=>b(-1)),color:"primary",label:"\u65B0\u589E\u8CBC\u6587"})])]),d("div",$,[i(F,{align:"center",title:"\u8CBC\u6587\u8CC7\u8A0A",columns:V,rows:n,"row-key":"_id",filter:t.filter},{"top-right":o(()=>[i(p,{borderless:"",dense:"",debounce:"300",modelValue:t.filter,"onUpdate:modelValue":l[1]||(l[1]=s=>t.filter=s),placeholder:"Search"},{append:o(()=>[i(_,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"]),i(j,{align:"center",modelValue:e.dialog,"onUpdate:modelValue":l[5]||(l[5]=s=>e.dialog=s),persistent:""},{default:o(()=>[i(q,{class:"column",style:{width:"700px","max-width":"80vw"}},{default:o(()=>[i(N,{onSubmit:x,onReset:Q},{default:o(()=>[i(w,{class:"row flex justify-between"},{default:o(()=>[d("div",E,[d("div",H,y(e._id.length>0?"\u7DE8\u8F2F\u95DC\u65BC\u6211\u5011":"\u65B0\u589E\u95DC\u65BC\u6211\u5011"),1)]),C((g(),k(c,{dense:"",flat:"",icon:"close"},{default:o(()=>[i(I,null,{default:o(()=>[S("Close")]),_:1})]),_:1})),[[U]])]),_:1}),i(B,{class:"column q-gutter-md"},{default:o(()=>{var s;return[d("div",O,[i(p,{square:"",filled:"",modelValue:e.title,"onUpdate:modelValue":l[2]||(l[2]=a=>e.title=a),label:"\u6587\u7AE0\u6A19\u984C",rules:[u.required]},null,8,["modelValue","rules"])]),d("div",X,[i(p,{square:"",filled:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=a=>e.description=a),type:"textarea",label:"\u6587\u7AE0\u5167\u5BB9",rules:[u.required]},null,8,["modelValue","rules"])]),d("div",z,[d("div",G,[i(D,{src:(s=n[e.idx])==null?void 0:s.image,style:{height:"100px"}},null,8,["src"]),i(T,{filled:"",modelValue:e.image,"onUpdate:modelValue":l[4]||(l[4]=a=>e.image=a),label:"\u8ACB\u4E0A\u50B3\u5716\u7247",style:{"max-height":"50px"},rules:[u.required]},{append:o(()=>[i(_,{name:"close",onClick:h})]),_:1},8,["modelValue","rules"])])])]}),_:1}),i(w,{align:"right"},{default:o(()=>[i(c,{disabled:e.loading,flat:"",label:"reset",type:"reset",color:"red"},null,8,["disabled"]),i(c,{disabled:e.loading,flat:"",label:"submit",type:"submit",color:"green"},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}};export{re as default};
