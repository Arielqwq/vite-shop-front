import{W as g,r as Q,b1 as f,aY as u,j as _,k as C,l as i,d as t,X as n,ac as k,Y as r,Q as b,G as c,aa as U,Z as S,b3 as w,ab as B,a7 as D,a5 as T,a2 as I,a3 as N,b2 as j,ae as A}from"./index.e4fac5c1.js";import{Q as V}from"./QTd.eccedd07.js";import{Q as F}from"./QTable.0aa23266.js";import{a as R}from"./QCheckbox.993bad15.js";import"./QMenu.6072e1f2.js";import"./QChip.ad57db13.js";import"./QItemLabel.70f6e0e9.js";import"./format.2a3572e1.js";const Y={class:"q-pa-md",id:"customersview"},$=i("h3",{class:"text-center"},"\u6703\u54E1\u7BA1\u7406",-1),z={class:"q-px-xl q-mx-md"},E={class:"div q-pa-md row",align:"left"},G={class:"text-center"},P={class:"col-12"},W={class:"col-12"},X={class:"col-12"},Z={class:"col-12"},H={class:"col-2"},oe={__name:"CustomersView",setup(J){const s=g([]),m=Q(""),p={required(l){return!!l||"\u6B04\u4F4D\u5FC5\u586B"}},e=g({_id:"",account:"",password:"",email:0,name:"",phone:"",sell:"",loading:!1,dialog:!1,idx:-1}),h=l=>{l===-1?(e._id="",e.account="",e.password="",e.email="",e.name="",e.phone="",e.sell="",e.loading=!1,e.dialog=!1,e.idx=-1):(e._id=s[l]._id,e.account=s[l].account,e.password=s[l].password,e.email=s[l].email,e.name=s[l].name,e.phone=s[l].phone,e.sell=s[l].sell,e.loading=s[l].loading,e.dialog=s[l].dialog,e.idx=l),e.dialog=!0},v=[{name:"account",required:!0,label:"\u5E33\u865F",align:"center",field:l=>l.account},{name:"email",required:!0,label:"\u4FE1\u7BB1",align:"center",field:l=>l.email,format:l=>`${l}`,sortable:!0},{name:"username",label:"\u6703\u54E1\u59D3\u540D",align:"center",field:l=>l.username},{name:"phone",label:"\u9023\u7D61\u96FB\u8A71",align:"center",field:l=>l.phone},{name:"role",required:!0,label:"\u8EAB\u5206\u5225",align:"center",field:l=>l.role},{name:"edit",label:"\u7DE8\u8F2F",align:"center"}],q=()=>{e.account=null,e.email=null,e.name=null,e.phone=null,e.sell=!1,e.image=void 0},x=async()=>{var o,a;e.loading=!0;const l=new FormData;l.append("title",e.title);try{if(e._id.length===0){const{data:d}=await f.post("/users",l);s.push(d.result),u.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6D3B\u52D5\u6210\u529F"}),console.log(s)}else{const{data:d}=await f.patch("/users/"+e._id,l);s[e.idx]=d.result,u.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6703\u54E1\u8CC7\u6599\u6210\u529F"})}e.dialog=!1}catch(d){u.fire({icon:"error",title:"\u5931\u6557",text:((a=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:a.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var l,o;try{const{data:a}=await f.get("/users/all");s.push(...a.result),console.log(s)}catch(a){console.log(a),u.fire({icon:"error",title:"\u5931\u6557",text:((o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(l,o)=>(_(),C("div",Y,[$,i("div",z,[t(F,{columns:v,rows:s,"row-key":"_id",filter:m.value,"rows-per-page-options":[5]},{"top-right":n(()=>[t(r,{outlined:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=a=>m.value=a),placeholder:"Search"},{append:n(()=>[t(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-role":n(a=>[t(V,{class:"text-center"},{default:n(()=>[t(b,{size:"md",name:a.row.role==1?"fa-solid fa-user-gear":"fa-solid fa-user"},null,8,["name"])]),_:2},1024)]),"body-cell-edit":n(a=>[t(V,{class:"text-center"},{default:n(()=>[t(c,{round:"",color:"primary","text-color":"white",icon:"edit",onClick:d=>h(s.findIndex(y=>y._id===a.row._id))},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"]),t(k,{align:"center",modelValue:e.dialog,"onUpdate:modelValue":o[6]||(o[6]=a=>e.dialog=a),persistent:""},{default:n(()=>[t(U,{class:"column",style:{width:"700px","max-width":"80vw"}},{default:n(()=>[t(S,{onSubmit:x,onReset:q},{default:n(()=>[t(w,{class:"row flex justify-between"},{default:n(()=>[i("div",E,[i("div",G,B(e._id.length>0?"\u7DE8\u8F2F\u5E33\u865F":"\u65B0\u589E\u5E33\u865F"),1)]),D((_(),T(c,{dense:"",flat:"",icon:"close"},{default:n(()=>[t(I,null,{default:n(()=>[N("Close")]),_:1})]),_:1})),[[A]])]),_:1}),t(j,{class:"column q-gutter-md"},{default:n(()=>[i("div",P,[t(r,{square:"",filled:"",modelValue:e.account,"onUpdate:modelValue":o[1]||(o[1]=a=>e.account=a),label:"\u5E33\u865F",rules:[p.required]},null,8,["modelValue","rules"])]),i("div",W,[t(r,{square:"",filled:"",modelValue:e.password,"onUpdate:modelValue":o[2]||(o[2]=a=>e.password=a),type:"number",label:"\u5BC6\u78BC",rules:[p.required]},null,8,["modelValue","rules"])]),i("div",X,[t(r,{square:"",filled:"",modelValue:e.email,"onUpdate:modelValue":o[3]||(o[3]=a=>e.email=a),type:"email",label:"\u4FE1\u7BB1",rules:[p.required]},null,8,["modelValue","rules"])]),i("div",Z,[t(r,{square:"",filled:"",modelValue:e.name,"onUpdate:modelValue":o[4]||(o[4]=a=>e.name=a),type:"text",label:"\u59D3\u540D"},null,8,["modelValue"])]),i("div",H,[t(R,{modelValue:e.sell,"onUpdate:modelValue":o[5]||(o[5]=a=>e.sell=a),label:"\u72C0\u614B"},null,8,["modelValue"])])]),_:1}),t(w,{align:"right"},{default:n(()=>[t(c,{disabled:e.loading,flat:"",label:"reset",type:"reset",color:"red"},null,8,["disabled"]),t(c,{disabled:e.loading,flat:"",label:"submit",type:"submit",color:"green"},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}};export{oe as default};
