import{W as b,b1 as u,aY as i,j as c,k as d,l as s,d as l,X as n,Y as g,Q as h,F as w,aZ as q,ab as x,G as y}from"./index.e4fac5c1.js";import{Q as m}from"./QTd.eccedd07.js";import{Q}from"./QTable.0aa23266.js";import"./QCheckbox.993bad15.js";import"./QMenu.6072e1f2.js";import"./QChip.ad57db13.js";import"./QItemLabel.70f6e0e9.js";import"./format.2a3572e1.js";const V={class:"q-pa-md",id:"orders"},k=s("h3",{class:"text-center"},"\u8A02\u55AE\u7BA1\u7406",-1),D={class:"q-px-xl q-mt-md"},P={__name:"OrdersView",setup(I){const o=b([]),p=[{name:"name",required:!0,label:"\u8A02\u55AE\u7DE8\u865F",align:"center",field:e=>e._id,sortable:!0},{name:"ID",required:!0,label:"\u6D88\u8CBB\u8005 ID",align:"center",field:e=>e.u_id.account,sortable:!0},{name:"date",required:!0,label:"\u8A02\u55AE\u65E5\u671F",align:"center",field:e=>new Date(e.date).toLocaleDateString(),sortable:!0},{name:"price",required:!0,label:"\u8A02\u55AE\u91D1\u984D",align:"center",field:e=>e.totalPrice,sortable:!0},{name:"content",label:"\u8A02\u55AE\u5167\u5BB9",align:"center"},{name:"delete",label:"\u522A\u9664",align:"center"}],f=async e=>{var r,a;console.log(e);try{await u.patch("/orders/delete/"+e,{status:1});const t=o.findIndex(_=>_._id===e);o.splice(t,1),i.fire({icon:"success",title:"\u6210\u529F",text:"\u6210\u529F\u522A\u9664"})}catch(t){i.fire({icon:"error",title:"\u5931\u6557",text:((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.message)||"\u767C\u751F\u932F\u8AA4"})}};return(async()=>{try{const{data:e}=await u.get("/orders/all");o.push(...e.result.map(r=>(r.totalPrice=r.products.reduce((a,t)=>a+t.p_id.price*t.quantity,0),r)))}catch(e){console.log(e),i.fire({icon:"error",title:"\u5931\u6557",text:"\u53D6\u5F97\u8A02\u55AE\u5931\u6557"})}})(),(e,r)=>(c(),d("div",V,[k,s("div",D,[l(Q,{columns:p,rows:o},{"top-right":n(()=>[l(g,{outlined:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":r[0]||(r[0]=a=>e.filter=a),placeholder:"Search"},{append:n(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-content":n(a=>[l(m,null,{default:n(()=>[s("ul",null,[(c(!0),d(w,null,q(a.row.products,t=>(c(),d("li",null,[s("p",null,x(t.quantity+" \u500B "+t.p_id.name),1)]))),256))])]),_:2},1024)]),"body-cell-delete":n(a=>[l(m,null,{default:n(()=>[l(y,{onClick:t=>f(a.row._id),round:"",icon:"fa-solid fa-trash-can"},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows"])])]))}};export{P as default};
